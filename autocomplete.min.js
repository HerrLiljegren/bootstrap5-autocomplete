var f={showAllSuggestions:!1,suggestionsThreshold:1,maximumItems:0,autoselectFirst:!0,updateOnSelect:!1,highlightTyped:!1,fullWidth:!1,fixed:!1,activeClasses:["bg-primary","text-white"],labelField:"label",valueField:"value",queryParam:"query",items:[],source:null,datalist:"",server:"",serverParams:{},liveServer:!1,noCache:!0,debounceTime:300,notFoundMessage:"",onRenderItem:(a,e)=>e,onSelectItem:a=>{},onServerResponse:a=>a.json()},m="is-loading",p="is-active",h="show",l="next",b="prev",c=new WeakMap,g=0;function w(a,e=300){let i;return(...t)=>{clearTimeout(i),i=setTimeout(()=>{a.apply(this,t)},e)}}function u(a){return a.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function L(a,e){return a.parentNode.insertBefore(e,a.nextSibling)}var v=class{constructor(e,i={}){if(!(e instanceof HTMLElement)){console.error("Invalid element",e);return}c.set(e,this),g++,this.s=e,this.p(i),this.h=!1,this.n=!1,this.b=w(()=>{this.f(!0)},this.e.debounceTime),this.g(),this.v(),this.e.fixed&&(document.addEventListener("scroll",this),document.addEventListener("resize",this)),this.s.addEventListener("focus",this),this.s.addEventListener("blur",this),this.s.addEventListener("input",this),this.s.addEventListener("keydown",this),this.i.addEventListener("mousemove",this),this.S()}static init(e="input.autocomplete",i={}){document.querySelectorAll(e).forEach(s=>{this.getOrCreateInstance(s,i)})}static getInstance(e){return c.has(e)?c.get(e):null}static getOrCreateInstance(e,i={}){return this.getInstance(e)||new this(e,i)}dispose(){this.s.removeEventListener("focus",this),this.s.removeEventListener("blur",this),this.s.removeEventListener("input",this),this.s.removeEventListener("keydown",this),this.i.removeEventListener("mousemove",this),this.e.fixed&&(document.removeEventListener("scroll",this),document.removeEventListener("resize",this)),this.i.parentElement.removeChild(this.i),c.delete(this.s)}handleEvent(e){this[`on${e.type}`](e)}p(e={}){this.e=Object.assign({},f);let i={...e,...this.s.dataset},t=s=>["true","false","1","0",!0,!1].includes(s)&&!!JSON.parse(s);for(let[s,n]of Object.entries(f)){if(i[s]===void 0)continue;let r=i[s];switch(typeof n){case"number":this.e[s]=parseInt(r);break;case"boolean":this.e[s]=t(r);break;case"string":this.e[s]=r.toString();break;case"object":if(Array.isArray(n))if(typeof r=="string"){let o=r.includes("|")?"|":",";this.e[s]=r.split(o)}else this.e[s]=r;else this.e[s]=typeof r=="string"?JSON.parse(r):r;break;case"function":this.e[s]=typeof r=="string"?window[r]:r;break;default:this.e[s]=r;break}}}g(){this.s.autocomplete="off",this.s.spellcheck=!1,this.s.ariaAutoComplete="list",this.s.ariaExpanded="false",this.s.ariaHasPopup="menu",this.s.setAttribute("role","combobox")}v(){this.i=document.createElement("ul"),this.i.setAttribute("id","ac-menu-"+g),this.i.setAttribute("role","menu"),this.i.classList.add("dropdown-menu","autocomplete-menu","p-0"),this.i.style.maxHeight="280px",this.e.fullWidth||(this.i.style.maxWidth="360px"),this.e.fixed&&(this.i.style.position="fixed"),this.i.style.overflowY="auto",L(this.s,this.i),this.s.setAttribute("aria-controls",this.i.getAttribute("id"))}oninput(e){this.h||this.showOrSearch()}onblur(e){this.hideSuggestions()}onfocus(e){this.showOrSearch()}onkeydown(e){if(!this.isDropdownVisible())return;switch(e.keyCode||e.key){case 13:case"Enter":e.preventDefault();let t=this.getSelection();t&&t.click();break;case 38:case"ArrowUp":e.preventDefault(),this.n=!0,this.l(b);break;case 40:case"ArrowDown":e.preventDefault(),this.n=!0,this.l(l);break;case 27:case"Escape":this.s.focus(),this.hideSuggestions();break}}onmousemove(e){this.n=!1}onscroll(e){this.c()}onresize(e){this.c()}getConfig(e=null){return e!==null?this.e[e]:this.e}setConfig(e,i){this.e[e]=i}setData(e){this.r={},this.u(e)}enable(){this.s.setAttribute("disabled","")}disable(){this.s.removeAttribute("disabled")}isDisabled(){return this.s.hasAttribute("disabled")||this.s.disabled||this.s.hasAttribute("readonly")}isDropdownVisible(){return this.i.classList.contains(h)}getSelection(){return this.i.querySelector("a."+p)}removeSelection(){let e=this.getSelection();e&&e.classList.remove(...this.a())}a(){return[...this.e.activeClasses,p]}l(e=l){let i=this.getSelection(),t=null;if(!i)t=this.i.firstChild;else{let s=e===l?"nextSibling":"previousSibling";t=i.parentNode;do t=t[s];while(t&&t.style.display=="none");t?(i.classList.remove(...this.a()),e===b?t.parentNode.scrollTop=t.offsetTop-t.parentNode.offsetTop:t.offsetTop>t.parentNode.offsetHeight-t.offsetHeight&&(t.parentNode.scrollTop+=t.offsetHeight)):i&&(t=i.parentElement)}if(t){let s=t.querySelector("a");s.classList.add(...this.a()),this.s.setAttribute("aria-activedescendant",s.getAttribute("id")),this.e.updateOnSelect&&(this.s.value=s.dataset.label)}else this.s.setAttribute("aria-activedescendant","");return t}w(){return this.isDisabled()?!1:this.s.value.length>=this.e.suggestionsThreshold}showOrSearch(e=!0){if(e&&!this.w()){this.hideSuggestions();return}this.e.liveServer?this.b():this.e.source?this.e.source(this.s.value,i=>{this.setData(i),this.d()}):this.d()}L(e,i){let t=i.label;if(this.e.highlightTyped){let r=u(t).toLowerCase().indexOf(e);t=t.substring(0,r)+`<mark>${t.substring(r,r+e.length)}</mark>`+t.substring(r+e.length,t.length)}t=this.e.onRenderItem(i,t);let s=document.createElement("li");s.setAttribute("role","presentation");let n=document.createElement("a");if(s.append(n),n.setAttribute("id",this.i.getAttribute("id")+"-"+this.i.children.length),n.classList.add("dropdown-item","text-truncate"),n.setAttribute("data-value",i.value),n.setAttribute("data-label",i.label),n.setAttribute("tabindex","-1"),n.setAttribute("role","menuitem"),n.setAttribute("href","#"),n.innerHTML=t,i.data)for(let[r,o]of Object.entries(i.data))n.dataset[r]=o;return n.addEventListener("mouseenter",r=>{this.n||(this.removeSelection(),s.querySelector("a").classList.add(...this.a()))}),n.addEventListener("mousedown",r=>{r.preventDefault()}),n.addEventListener("click",r=>{r.preventDefault(),this.h=!0,this.s.value=i.label,this.e.onSelectItem(i),this.hideSuggestions(),this.h=!1}),s}d(){let e=u(this.s.value).toLowerCase();this.i.innerHTML="";let i=Object.keys(this.r),t=0,s=null;for(let n=0;n<i.length;n++){let r=i[n],o=this.r[r],y=u(o.label).toLowerCase(),S=e.length>0?y.indexOf(e)>=0:!0;if(this.e.showAllSuggestions||S){t++;let d=this.L(e,o);if(s||(s=d),this.i.appendChild(d),this.e.maximumItems>0&&t>=this.e.maximumItems)break}}if(s&&this.e.autoselectFirst&&this.l(l),t===0)if(this.e.notFoundMessage){let n=document.createElement("li");n.setAttribute("role","presentation"),n.innerHTML=`<span class="dropdown-item">${this.e.notFoundMessage}</span>`,this.i.appendChild(n),this.m()}else this.hideSuggestions();else this.m()}m(){this.i.classList.add(h),this.s.ariaExpanded="true",this.c()}toggleSuggestions(e=!0){this.i.classList.contains(h)?this.hideSuggestions():this.showOrSearch(e)}hideSuggestions(){this.i.classList.remove(h),this.s.ariaExpanded="false",this.removeSelection()}A(){let e=this.s.parentElement;for(;e&&e instanceof HTMLElement;){if(e.style.position==="fixed")return!0;e=e.parentElement}return!1}c(){let e=this.s.getBoundingClientRect(),i=this.A();if(this.e.fullWidth)this.i.style.width=this.s.offsetWidth+"px";else{let t=i?window.innerWidth:document.body.offsetWidth,s=30,n=t-1-(e.x+this.i.offsetWidth)-s;n<0&&(this.i.style.transform="translateX(calc("+n+"px))")}if(this.e.fixed)this.i.style.transform="translateY(calc(-"+window.pageYOffset+"px))";else{let t=i?window.innerHeight:document.body.offsetHeight,s=e.y+window.pageYOffset+this.i.offsetHeight;t-s<0&&t>e.height?this.i.style.transform="translateY(calc(-100% - "+this.s.offsetHeight+"px))":this.i.style.transform="none"}}S(){if(this.r={},this.u(this.e.items),this.e.datalist){let e=document.querySelector(`#${this.e.datalist}`);if(e){let i=Array.from(e.children).map(t=>{let s=t.getAttribute("value")??t.innerHTML.toLowerCase(),n=t.innerHTML;return{value:s,label:n}});this.u(i)}}this.e.server&&!this.e.liveServer&&this.f()}u(e){let i=Object.keys(e);for(let t=0;t<i.length;t++){let s=i[t],n=e[s],r=typeof n=="string"?{}:n;r.label=n[this.e.labelField]??n,r.value=n[this.e.valueField]??s,this.r[r.value]=r}}f(e=!1){this.o&&this.o.abort(),this.o=new AbortController;let i=Object.assign({},this.e.serverParams);if(i[this.e.queryParam]=this.s.value,this.e.noCache&&(i.t=Date.now()),i.related){let s=document.getElementById(i.related);s&&(i.related=s.value)}let t=new URLSearchParams(i).toString();this.s.classList.add(m),fetch(this.e.server+"?"+t,{signal:this.o.signal}).then(s=>this.e.onServerResponse(s)).then(s=>{let n=s.data||s;this.setData(n),this.o=null,e&&this.d()}).catch(s=>{s.name!=="AbortError"&&console.error(s)}).finally(s=>{this.s.classList.remove(m)})}},A=v;export{A as default};
//# sourceMappingURL=autocomplete.min.js.map
