var p={showAllSuggestions:!1,suggestionsThreshold:1,maximumItems:0,autoselectFirst:!0,updateOnSelect:!1,highlightTyped:!1,fullWidth:!1,fixed:!1,activeClasses:["bg-primary","text-white"],labelField:"label",valueField:"value",queryParam:"query",items:[],source:null,datalist:"",server:"",serverParams:{},liveServer:!1,noCache:!0,debounceTime:300,notFoundMessage:"",onRenderItem:(o,t)=>t,onSelectItem:o=>{},onServerResponse:o=>o.json()},g="is-loading",b="is-active",h="show",c="next",v="prev",u=new WeakMap,y=0;function w(o,t=300){let s;return(...e)=>{clearTimeout(s),s=setTimeout(()=>{o.apply(this,e)},t)}}function d(o){return o.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function L(o,t){return o.parentNode.insertBefore(t,o.nextSibling)}var S=class{constructor(t,s={}){if(!(t instanceof HTMLElement)){console.error("Invalid element",t);return}u.set(t,this),y++,this.s=t,this.p(s),this.l=!1,this.n=!1,this.g=w(()=>{this.f(!0)},this.e.debounceTime),this.b(),this.v(),this.e.fixed&&(document.addEventListener("scroll",this,!0),window.addEventListener("resize",this)),this.s.addEventListener("focus",this),this.s.addEventListener("blur",this),this.s.addEventListener("input",this),this.s.addEventListener("keydown",this),this.i.addEventListener("mousemove",this),this.S()}static init(t="input.autocomplete",s={}){document.querySelectorAll(t).forEach(i=>{this.getOrCreateInstance(i,s)})}static getInstance(t){return u.has(t)?u.get(t):null}static getOrCreateInstance(t,s={}){return this.getInstance(t)||new this(t,s)}dispose(){this.s.removeEventListener("focus",this),this.s.removeEventListener("blur",this),this.s.removeEventListener("input",this),this.s.removeEventListener("keydown",this),this.i.removeEventListener("mousemove",this),this.e.fixed&&(document.removeEventListener("scroll",this,!0),window.removeEventListener("resize",this)),this.i.parentElement.removeChild(this.i),u.delete(this.s)}handleEvent(t){this[`on${t.type}`](t)}p(t={}){this.e=Object.assign({},p);let s={...t,...this.s.dataset},e=i=>["true","false","1","0",!0,!1].includes(i)&&!!JSON.parse(i);for(let[i,n]of Object.entries(p)){if(s[i]===void 0)continue;let r=s[i];switch(typeof n){case"number":this.e[i]=parseInt(r);break;case"boolean":this.e[i]=e(r);break;case"string":this.e[i]=r.toString();break;case"object":if(Array.isArray(n))if(typeof r=="string"){let a=r.includes("|")?"|":",";this.e[i]=r.split(a)}else this.e[i]=r;else this.e[i]=typeof r=="string"?JSON.parse(r):r;break;case"function":this.e[i]=typeof r=="string"?window[r]:r;break;default:this.e[i]=r;break}}}b(){this.s.autocomplete="off",this.s.spellcheck=!1,this.s.ariaAutoComplete="list",this.s.ariaExpanded="false",this.s.ariaHasPopup="menu",this.s.setAttribute("role","combobox")}v(){this.i=document.createElement("ul"),this.i.setAttribute("id","ac-menu-"+y),this.i.setAttribute("role","menu"),this.i.classList.add("dropdown-menu","autocomplete-menu","p-0"),this.i.style.maxHeight="280px",this.e.fullWidth||(this.i.style.maxWidth="360px"),this.e.fixed&&(this.i.style.position="fixed"),this.i.style.overflowY="auto",this.i.style.overscrollBehavior="contain",this.i.style.textAlign="unset",L(this.s,this.i),this.s.setAttribute("aria-controls",this.i.getAttribute("id"))}oninput(t){this.l||this.showOrSearch()}onblur(t){this.hideSuggestions()}onfocus(t){this.showOrSearch()}onkeydown(t){switch(t.keyCode||t.key){case 13:case"Enter":if(this.isDropdownVisible()){t.preventDefault();let e=this.getSelection();e&&e.click()}break;case 38:case"ArrowUp":t.preventDefault(),this.n=!0,this.h(v);break;case 40:case"ArrowDown":t.preventDefault(),this.n=!0,this.isDropdownVisible()?this.h(c):this.showOrSearch(!1);break;case 27:case"Escape":this.isDropdownVisible()&&(this.s.focus(),this.hideSuggestions());break}}onmousemove(t){this.n=!1}onscroll(t){this.c()}onresize(t){this.c()}getConfig(t=null){return t!==null?this.e[t]:this.e}setConfig(t,s){this.e[t]=s}setData(t){this.r={},this.u(t)}enable(){this.s.setAttribute("disabled","")}disable(){this.s.removeAttribute("disabled")}isDisabled(){return this.s.hasAttribute("disabled")||this.s.disabled||this.s.hasAttribute("readonly")}isDropdownVisible(){return this.i.classList.contains(h)}getSelection(){return this.i.querySelector("a."+b)}removeSelection(){let t=this.getSelection();t&&t.classList.remove(...this.o())}o(){return[...this.e.activeClasses,b]}h(t=c){let s=this.getSelection(),e=null;if(!s)e=this.i.firstChild;else{let i=t===c?"nextSibling":"previousSibling";e=s.parentNode;do e=e[i];while(e&&e.style.display=="none");e?(s.classList.remove(...this.o()),t===v?e.parentNode.scrollTop=e.offsetTop-e.parentNode.offsetTop:e.offsetTop>e.parentNode.offsetHeight-e.offsetHeight&&(e.parentNode.scrollTop+=e.offsetHeight)):s&&(e=s.parentElement)}if(e){let i=e.querySelector("a");i.classList.add(...this.o()),this.s.setAttribute("aria-activedescendant",i.getAttribute("id")),this.e.updateOnSelect&&(this.s.value=i.dataset.label)}else this.s.setAttribute("aria-activedescendant","");return e}w(){return this.isDisabled()?!1:this.s.value.length>=this.e.suggestionsThreshold}showOrSearch(t=!0){if(t&&!this.w()){this.hideSuggestions();return}this.e.liveServer?this.g():this.e.source?this.e.source(this.s.value,s=>{this.setData(s),this.d()}):this.d()}L(t,s){let e=s.label;if(this.e.highlightTyped){let r=d(e).toLowerCase().indexOf(t);e=e.substring(0,r)+`<mark>${e.substring(r,r+t.length)}</mark>`+e.substring(r+t.length,e.length)}e=this.e.onRenderItem(s,e);let i=document.createElement("li");i.setAttribute("role","presentation");let n=document.createElement("a");if(i.append(n),n.setAttribute("id",this.i.getAttribute("id")+"-"+this.i.children.length),n.classList.add("dropdown-item","text-truncate"),n.setAttribute("data-value",s.value),n.setAttribute("data-label",s.label),n.setAttribute("tabindex","-1"),n.setAttribute("role","menuitem"),n.setAttribute("href","#"),n.innerHTML=e,s.data)for(let[r,a]of Object.entries(s.data))n.dataset[r]=a;return n.addEventListener("mouseenter",r=>{this.n||(this.removeSelection(),i.querySelector("a").classList.add(...this.o()))}),n.addEventListener("mousedown",r=>{r.preventDefault()}),n.addEventListener("click",r=>{r.preventDefault(),this.l=!0,this.s.value=s.label,this.e.onSelectItem(s),this.hideSuggestions(),this.l=!1}),i}d(){let t=d(this.s.value).toLowerCase();this.i.innerHTML="";let s=Object.keys(this.r),e=0,i=null;for(let n=0;n<s.length;n++){let r=s[n],a=this.r[r],l=d(a.label).toLowerCase(),f=t.length>0?l.indexOf(t)>=0:!0;if(this.e.showAllSuggestions||f){e++;let m=this.L(t,a);if(i||(i=m),this.i.appendChild(m),this.e.maximumItems>0&&e>=this.e.maximumItems)break}}if(i&&this.e.autoselectFirst&&this.h(c),e===0)if(this.e.notFoundMessage){let n=document.createElement("li");n.setAttribute("role","presentation"),n.innerHTML=`<span class="dropdown-item">${this.e.notFoundMessage}</span>`,this.i.appendChild(n),this.m()}else this.hideSuggestions();else this.m()}m(){this.i.classList.add(h),this.s.ariaExpanded="true",this.c()}toggleSuggestions(t=!0){this.i.classList.contains(h)?this.hideSuggestions():this.showOrSearch(t)}hideSuggestions(){this.i.classList.remove(h),this.s.ariaExpanded="false",this.removeSelection()}A(){let t=this.s.parentElement;for(;t&&t instanceof HTMLElement;){if(t.style.position==="fixed")return!0;t=t.parentElement}return!1}c(){let t=window.getComputedStyle(this.s),s=this.s.getBoundingClientRect(),e=this.A(),i=t.direction==="rtl",n=null,r=null;this.e.fixed&&(n=s.x,r=s.y+s.height,i&&!this.e.fullWidth&&(n-=this.i.offsetWidth-s.width)),this.i.style.transform="unset",this.e.fullWidth&&(this.i.style.width=this.s.offsetWidth+"px"),n!==null&&(this.i.style.left=n+"px"),r!==null&&(this.i.style.top=r+"px");let a=this.i.getBoundingClientRect(),l=e?window.innerHeight:document.body.offsetHeight;l-1-(a.y+a.height)<0&&s.y>l/2&&(this.i.style.transform="translateY(calc(-100% - "+this.s.offsetHeight+"px))")}S(){if(this.r={},this.u(this.e.items),this.e.datalist){let t=document.querySelector(`#${this.e.datalist}`);if(t){let s=Array.from(t.children).map(e=>{let i=e.getAttribute("value")??e.innerHTML.toLowerCase(),n=e.innerHTML;return{value:i,label:n}});this.u(s)}}this.e.server&&!this.e.liveServer&&this.f()}u(t){let s=Object.keys(t);for(let e=0;e<s.length;e++){let i=s[e],n=t[i],r=typeof n=="string"?{}:n;r.label=n[this.e.labelField]??n,r.value=n[this.e.valueField]??i,this.r[r.value]=r}}f(t=!1){this.a&&this.a.abort(),this.a=new AbortController;let s=Object.assign({},this.e.serverParams);if(s[this.e.queryParam]=this.s.value,this.e.noCache&&(s.t=Date.now()),s.related){let i=document.getElementById(s.related);i&&(s.related=i.value)}let e=new URLSearchParams(s).toString();this.s.classList.add(g),fetch(this.e.server+"?"+e,{signal:this.a.signal}).then(i=>this.e.onServerResponse(i)).then(i=>{let n=i.data||i;this.setData(n),this.a=null,t&&this.d()}).catch(i=>{i.name!=="AbortError"&&console.error(i)}).finally(i=>{this.s.classList.remove(g)})}},A=S;export{A as default};
//# sourceMappingURL=autocomplete.min.js.map
