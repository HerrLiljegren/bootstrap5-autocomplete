var b={showAllSuggestions:!1,suggestionsThreshold:1,maximumItems:0,autoselectFirst:!0,updateOnSelect:!1,highlightTyped:!1,fullWidth:!1,fixed:!1,fuzzy:!1,activeClasses:["bg-primary","text-white"],labelField:"label",valueField:"value",searchFields:["label"],queryParam:"query",items:[],source:null,hiddenInput:!1,hiddenValue:"",datalist:"",server:"",serverMethod:"GET",serverParams:{},serverDataKey:"data",fetchOptions:{},liveServer:!1,noCache:!0,debounceTime:300,notFoundMessage:"",onRenderItem:(a,t,e)=>t,onSelectItem:(a,t)=>{},onServerResponse:(a,t)=>a.json()},y="is-loading",S="is-active",c="show",d="next",w="prev",f=new WeakMap,L=0,m=0;function x(a,t=300){let e;return(...s)=>{clearTimeout(e),e=setTimeout(()=>{a.apply(this,s)},t)}}function T(a){return a.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function p(a){return a?T(a.toString()).toLowerCase():""}function k(a,t){if(a.indexOf(t)>=0)return!0;let e=0;for(let s=0;s<t.length;s++){let n=t[s];if(n!=" "&&(e=a.indexOf(n,e)+1,e<=0))return!1}return!0}function A(a,t){return a.parentNode.insertBefore(t,a.nextSibling)}function C(a){var t=document.createElement("textarea");return t.innerHTML=a,t.value}var g=class{constructor(t,e={}){if(!(t instanceof HTMLElement)){console.error("Invalid element",t);return}f.set(t,this),L++,m++,this.s=t,this.b(e),this.l=!1,this.o=!1,this.S=x(()=>{this.m(!0)},this.e.debounceTime),this.w(),this.L(),this.e.fixed&&(document.addEventListener("scroll",this,!0),window.addEventListener("resize",this)),this.s.addEventListener("focus",this),this.s.addEventListener("blur",this),this.s.addEventListener("input",this),this.s.addEventListener("keydown",this),this.i.addEventListener("mousemove",this),this.A()}static init(t="input.autocomplete",e={}){document.querySelectorAll(t).forEach(n=>{this.getOrCreateInstance(n,e)})}static getInstance(t){return f.has(t)?f.get(t):null}static getOrCreateInstance(t,e={}){return this.getInstance(t)||new this(t,e)}dispose(){m--,this.s.removeEventListener("focus",this),this.s.removeEventListener("blur",this),this.s.removeEventListener("input",this),this.s.removeEventListener("keydown",this),this.i.removeEventListener("mousemove",this),this.e.fixed&&m<=0&&(document.removeEventListener("scroll",this,!0),window.removeEventListener("resize",this)),this.i.parentElement.removeChild(this.i),f.delete(this.s)}handleEvent(t){["scroll","resize"].includes(t.type)?(this.p&&window.cancelAnimationFrame(this.p),this.p=window.requestAnimationFrame(()=>{this[`on${t.type}`](t)})):this[`on${t.type}`](t)}b(t={}){this.e=Object.assign({},b);let e={...t,...this.s.dataset},s=n=>["true","false","1","0",!0,!1].includes(n)&&!!JSON.parse(n);for(let[n,r]of Object.entries(b)){if(e[n]===void 0)continue;let i=e[n];switch(typeof r){case"number":this.e[n]=parseInt(i);break;case"boolean":this.e[n]=s(i);break;case"string":this.e[n]=i.toString();break;case"object":if(Array.isArray(r))if(typeof i=="string"){let o=i.includes("|")?"|":",";this.e[n]=i.split(o)}else this.e[n]=i;else this.e[n]=typeof i=="string"?JSON.parse(i):i;break;case"function":this.e[n]=typeof i=="string"?window[i]:i;break;default:this.e[n]=i;break}}}w(){this.s.autocomplete="off",this.s.spellcheck=!1,this.s.ariaAutoComplete="list",this.s.ariaExpanded="false",this.s.ariaHasPopup="menu",this.s.setAttribute("role","combobox"),this.n=null,this.e.hiddenInput&&(this.n=document.createElement("input"),this.n.type="hidden",this.n.value=this.e.hiddenValue,this.n.name=this.s.name,this.s.name="_"+this.s.name,A(this.s,this.n))}L(){this.i=document.createElement("ul"),this.i.setAttribute("id","ac-menu-"+L),this.i.setAttribute("role","menu"),this.i.classList.add("dropdown-menu","autocomplete-menu","p-0"),this.i.style.maxHeight="280px",this.e.fullWidth||(this.i.style.maxWidth="360px"),this.e.fixed&&(this.i.style.position="fixed"),this.i.style.overflowY="auto",this.i.style.overscrollBehavior="contain",this.i.style.textAlign="unset",A(this.s,this.i),this.s.setAttribute("aria-controls",this.i.getAttribute("id"))}oninput(t){this.l||(this.n&&(this.n.value=null),this.showOrSearch())}onblur(t){this.hideSuggestions()}onfocus(t){this.showOrSearch()}onkeydown(t){switch(t.keyCode||t.key){case 13:case"Enter":if(this.isDropdownVisible()){t.preventDefault();let s=this.getSelection();s&&s.click()}break;case 38:case"ArrowUp":t.preventDefault(),this.o=!0,this.u(w);break;case 40:case"ArrowDown":t.preventDefault(),this.o=!0,this.isDropdownVisible()?this.u(d):this.showOrSearch(!1);break;case 27:case"Escape":this.isDropdownVisible()&&(this.s.focus(),this.hideSuggestions());break}}onmousemove(t){this.o=!1}onscroll(t){this.c()}onresize(t){this.c()}getConfig(t=null){return t!==null?this.e[t]:this.e}setConfig(t,e){this.e[t]=e}setData(t){this.r={},this.d(t)}enable(){this.s.setAttribute("disabled","")}disable(){this.s.removeAttribute("disabled")}isDisabled(){return this.s.hasAttribute("disabled")||this.s.disabled||this.s.hasAttribute("readonly")}isDropdownVisible(){return this.i.classList.contains(c)}getSelection(){return this.i.querySelector("a."+S)}removeSelection(){let t=this.getSelection();t&&t.classList.remove(...this.a())}a(){return[...this.e.activeClasses,S]}u(t=d){let e=this.getSelection(),s=null;if(!e)s=this.i.firstChild;else{let n=t===d?"nextSibling":"previousSibling";s=e.parentNode;do s=s[n];while(s&&s.style.display=="none");s?(e.classList.remove(...this.a()),t===w?s.parentNode.scrollTop=s.offsetTop-s.parentNode.offsetTop:s.offsetTop>s.parentNode.offsetHeight-s.offsetHeight&&(s.parentNode.scrollTop+=s.offsetHeight)):e&&(s=e.parentElement)}if(s){let n=s.querySelector("a");n.classList.add(...this.a()),this.s.setAttribute("aria-activedescendant",n.getAttribute("id")),this.e.updateOnSelect&&(this.s.value=n.dataset.label)}else this.s.setAttribute("aria-activedescendant","");return s}E(){return this.isDisabled()?!1:this.s.value.length>=this.e.suggestionsThreshold}showOrSearch(t=!0){if(t&&!this.E()){this.hideSuggestions();return}this.e.liveServer?this.S():this.e.source?this.e.source(this.s.value,e=>{this.setData(e),this.f()}):this.f()}T(t,e){let s=e.label;if(this.e.highlightTyped){let i=p(s).indexOf(t);s=s.substring(0,i)+`<mark>${s.substring(i,i+t.length)}</mark>`+s.substring(i+t.length,s.length)}s=this.e.onRenderItem(e,s,this);let n=document.createElement("li");n.setAttribute("role","presentation");let r=document.createElement("a");if(n.append(r),r.setAttribute("id",this.i.getAttribute("id")+"-"+this.i.children.length),r.classList.add("dropdown-item","text-truncate"),r.setAttribute("data-value",e.value),r.setAttribute("data-label",e.label),r.setAttribute("tabindex","-1"),r.setAttribute("role","menuitem"),r.setAttribute("href","#"),r.innerHTML=s,e.data)for(let[i,o]of Object.entries(e.data))r.dataset[i]=o;return r.addEventListener("mouseenter",i=>{this.o||(this.removeSelection(),n.querySelector("a").classList.add(...this.a()))}),r.addEventListener("mousedown",i=>{i.preventDefault()}),r.addEventListener("click",i=>{i.preventDefault(),this.l=!0,this.s.value=C(e.label),this.n&&(this.n.value=e.value),this.e.onSelectItem(e,this),this.hideSuggestions(),this.l=!1}),n}f(){let t=p(this.s.value);this.i.innerHTML="";let e=Object.keys(this.r),s=0,n=null;for(let r=0;r<e.length;r++){let i=e[r],o=this.r[i],h=this.e.showAllSuggestions,l=t.length==0&&this.e.suggestionsThreshold===0;!h&&t.length>0&&this.e.searchFields.forEach(u=>{let v=p(o[u]);(this.e.fuzzy?k(v,t):v.indexOf(t)>=0)&&(l=!0)});let E=l||t.length===0;if(h||l){s++;let u=this.T(t,o);if(!n&&E&&(n=u),this.i.appendChild(u),this.e.maximumItems>0&&s>=this.e.maximumItems)break}}if(n&&this.e.autoselectFirst&&this.u(d),s===0)if(this.e.notFoundMessage){let r=document.createElement("li");r.setAttribute("role","presentation"),r.innerHTML=`<span class="dropdown-item">${this.e.notFoundMessage}</span>`,this.i.appendChild(r),this.g()}else this.hideSuggestions();else this.g()}g(){this.i.classList.add(c),this.s.ariaExpanded="true",this.c()}toggleSuggestions(t=!0){this.i.classList.contains(c)?this.hideSuggestions():this.showOrSearch(t)}hideSuggestions(){this.i.classList.remove(c),this.s.ariaExpanded="false",this.removeSelection()}getInput(){return this.s}getDropMenu(){return this.i}k(){let t=this.s.parentElement;for(;t&&t instanceof HTMLElement;){if(t.style.position==="fixed")return!0;t=t.parentElement}return!1}c(){let t=window.getComputedStyle(this.s),e=this.s.getBoundingClientRect(),s=this.k(),n=t.direction==="rtl",r=null,i=null;this.e.fixed&&(r=e.x,i=e.y+e.height,n&&!this.e.fullWidth&&(r-=this.i.offsetWidth-e.width)),this.i.style.transform="unset",this.e.fullWidth&&(this.i.style.width=this.s.offsetWidth+"px"),r!==null&&(this.i.style.left=r+"px"),i!==null&&(this.i.style.top=i+"px");let o=this.i.getBoundingClientRect(),h=s?window.innerHeight:document.body.offsetHeight;h-1-(o.y+o.height)<0&&e.y>h/2&&(this.i.style.transform="translateY(calc(-100% - "+this.s.offsetHeight+"px))")}A(){this.r={},this.d(this.e.items);let t=this.e.datalist;if(t){let e=document.querySelector(`#${t}`);if(e){let s=Array.from(e.children).map(n=>{let r=n.getAttribute("value")??n.innerHTML.toLowerCase(),i=n.innerHTML;return{value:r,label:i}});this.d(s)}else console.error(`Datalist not found ${t}`)}this.v(),this.e.server&&!this.e.liveServer&&this.m()}v(){if(this.e.hiddenInput&&!this.e.hiddenValue)for(let[t,e]of Object.entries(this.r))e.label==this.s.value&&(this.n.value=t)}d(t){let e=Object.keys(t);for(let s=0;s<e.length;s++){let n=e[s],r=t[n],i=typeof r=="string"?r:r.label,o=typeof r!="object"?{}:r;o.label=r[this.e.labelField]??i,o.value=r[this.e.valueField]??n,o.label&&(this.r[o.value]=o)}}m(t=!1){this.h&&this.h.abort(),this.h=new AbortController;let e=Object.assign({},this.e.serverParams);if(e[this.e.queryParam]=this.s.value,this.e.noCache&&(e.t=Date.now()),e.related){let i=document.getElementById(e.related);if(i){e.related=i.value;let o=i.getAttribute("name");o&&(e[o]=i.value)}}let s=new URLSearchParams(e),n=this.e.server,r=Object.assign(this.e.fetchOptions,{method:this.e.serverMethod||"GET",signal:this.h.signal});r.method==="POST"?r.body=s:n+="?"+s.toString(),this.s.classList.add(y),fetch(n,r).then(i=>this.e.onServerResponse(i,this)).then(i=>{let o=i[this.e.serverDataKey]||i;this.setData(o),this.v(),this.h=null,t&&this.f()}).catch(i=>{i.name!=="AbortError"&&console.error(i)}).finally(i=>{this.s.classList.remove(y)})}},D=g;export{D as default};
//# sourceMappingURL=autocomplete.min.js.map
